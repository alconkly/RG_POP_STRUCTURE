RG_Dissected <- read_excel("Pop_Strucutre_Dissected.xlsx")
RG_Dissected<- RG_Dissected %>% dplyr:: select("Date", "Total.Mass", "Total.Length", "Sex", "Site", "Month", "Year")
RG_NotDissected <- read_excel("Pop_Strucutre_NotDissected.xlsx")
RG_NotDissected<- RG_NotDissected %>% dplyr:: select("Date", "Total.Mass", "Total.Length", "Sex", "Site", "Month", "Year")
AllRG<- rbind(RG_Dissected, RG_NotDissected)
AllRG %<>% na.omit(AllRG)
AllRG$Date <- as_date(AllRG$Date, format="%m-%d-%Y")
as.factor(AllRG$Month)
AllRG$Month<- factor(AllRG$Month, levels = c("May", "June", "July", "August", "September", "October"))
AllRG %>% arrange(Date)
AllRG %<>% group_by(Month, Year, Site, Sex)
AllRG %<>% mutate(lcat5=lencat(Total.Length, w=5), lcat10=lencat(Total.Length, w=10), logLength=log(Total.Length))
Males<- AllRG %>% filter(Sex=="M")
Females<- AllRG %>% filter(Sex=="F")
Cobb<- AllRG %>% filter(Site=="Cobb")
Cobb_M<- Cobb %>% filter(Sex=="M")
Cobb_F<- Cobb %>% filter(Sex=="F")
Cobb_I<- Cobb %>% filter(Sex=="I")
Rose<- AllRG %>% filter(Site=="Rose")
Rose_M<- Rose %>% filter(Sex=="M")
Rose_F<- Rose %>% filter(Sex=="F")
Rose_I<- Rose %>% filter(Sex=="I")
setwd("G:/POP_STRUCTURE_PUB/Data/Length_Sex")
AllRG<- read_excel("18-19_Length_sex.xlsx", col_names = TRUE)
AllRG<- read_excel("18-19_Length_sex.xlsx", col_names = TRUE)
AllRG<- read_excel("18-19_Length_sex.xlsx", col_names = TRUE)
setwd("G:/POP_STRUCTURE_PUB/Data/Length_Sex")
AllRG<- read_excel("18-19_Length_sex.xlsx", col_names = TRUE)
##Setup and data partitioning
getwd()
setwd("G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE")
RG_Dissected <- read_excel("Pop_Strucutre_Dissected.xlsx")
RG_Dissected<- RG_Dissected %>% dplyr:: select("Date", "Total.Mass", "Total.Length", "Sex", "Site", "Month", "Year")
RG_NotDissected <- read_excel("Pop_Strucutre_NotDissected.xlsx")
RG_NotDissected<- RG_NotDissected %>% dplyr:: select("Date", "Total.Mass", "Total.Length", "Sex", "Site", "Month", "Year")
AllRG<- rbind(RG_Dissected, RG_NotDissected)
AllRG %<>% na.omit(AllRG)
AllRG$Date <- as_date(AllRG$Date, format="%m-%d-%Y")
as.factor(AllRG$Month)
AllRG$Month<- factor(AllRG$Month, levels = c("May", "June", "July", "August", "September", "October"))
AllRG %>% arrange(Date)
AllRG %<>% group_by(Month, Year, Site, Sex)
AllRG %<>% mutate(lcat5=lencat(Total.Length, w=5), lcat10=lencat(Total.Length, w=10), logLength=log(Total.Length))
Males<- AllRG %>% filter(Sex=="M")
Females<- AllRG %>% filter(Sex=="F")
Cobb<- AllRG %>% filter(Site=="Cobb")
Cobb_M<- Cobb %>% filter(Sex=="M")
Cobb_F<- Cobb %>% filter(Sex=="F")
Cobb_I<- Cobb %>% filter(Sex=="I")
Rose<- AllRG %>% filter(Site=="Rose")
Rose_M<- Rose %>% filter(Sex=="M")
Rose_F<- Rose %>% filter(Sex=="F")
Rose_I<- Rose %>% filter(Sex=="I")
library(qwraps2)
library(kableExtra)
library(gridExtra)
options(qwraps2_markup = "markdown")
OurSummary<- list( ("Total Length (mm)" =
list ("minimum TL" = ~ min(Total.Length),
"maximum TL" = ~ max(Total.Length),
"mean (sd) TL" = ~ qwraps2:: mean_sd(Total.Length, denote_sd = "paren"))), ("n" = ("n" = ~ qwraps2::n())))
Cobb_M_Summary<- summary_table(dplyr:: group_by (Cobb_M, Month), OurSummary)
OurSummary<- list( ("Total Length (mm)" =
list ("minimum TL" = ~ min(Total.Length),
"maximum TL" = ~ max(Total.Length),
"mean (sd) TL" = ~ qwraps2:: mean_sd(Total.Length, denote_sd = "paren"))), ("n" = ("n" = ~ qwraps2::n())))
Cobb_M_Summary1<- Cobb_M %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
library(qwraps2)
library(kableExtra)
library(gridExtra)
options(qwraps2_markup = "markdown")
Cobb_M_Summary1<- Cobb_M %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_F_Summary1<- Cobb_F %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_I_Summary1<- Cobb_I %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})"))%>% modify_header(all_stat_cols() ~ "**{level}**")
(Cobb_Summary<- tbl_stack(tbls=list(Cobb_M_Summary1, Cobb_F_Summary1, Cobb_I_Summary1), group_header =c("Male", "Female", "Immature")) %>% as_gt() %>%
gt::tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
))
Cobb_Summary %>% gtsave(filename="Cobb_Summary.png", path="G:/POP_STRUCTURE_PUB/Figures")
library(qwraps2)
library(kableExtra)
library(gridExtra)
options(qwraps2_markup = "markdown")
Cobb_M_Summary1<- Cobb_M %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_F_Summary1<- Cobb_F %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_I_Summary1<- Cobb_I %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})"))%>% modify_header(all_stat_cols() ~ "**{level}**")
(Cobb_Summary<- tbl_stack(tbls=list(Cobb_M_Summary1, Cobb_F_Summary1, Cobb_I_Summary1), group_header =c("Male", "Female", "Immature")) %>% as_gt() %>%
gt::tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
))
Cobb_Summary %>% gtsave(filename="Cobb_Summary.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
(Rose_M_Summary1<- Rose_M %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
(Rose_F_Summary1<- Rose_F %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
(Rose_I_Summary1<- Rose_I %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
(Rose_Summary<- tbl_stack(tbls=list(Rose_M_Summary1, Rose_F_Summary1, Rose_I_Summary1), group_header =c("Male", "Female", "Immature"))  %>% as_gt() %>%
gt::tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
) )
Rose_Summary %>% gtsave(filename="Rose_Summary.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
library(qwraps2)
library(kableExtra)
library(gridExtra)
options(qwraps2_markup = "markdown")
Cobb_M_Summary1<- Cobb_M %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_F_Summary1<- Cobb_F %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_I_Summary1<- Cobb_I %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})"))%>% modify_header(all_stat_cols() ~ "**{level}**")
(Cobb_Summary<- tbl_stack(tbls=list(Cobb_M_Summary1, Cobb_F_Summary1, Cobb_I_Summary1), group_header =c("Male", "Female", "Immature")) %>% as_gt() %>%
gt::tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
))
Cobb_Summary %>% gtsave(filename="Cobb_Length_Summary.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
(Rose_M_Summary1<- Rose_M %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
(Rose_F_Summary1<- Rose_F %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
(Rose_I_Summary1<- Rose_I %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
(Rose_Summary<- tbl_stack(tbls=list(Rose_M_Summary1, Rose_F_Summary1, Rose_I_Summary1), group_header =c("Male", "Female", "Immature"))  %>% as_gt() %>%
gt::tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
) )
Rose_Summary %>% gtsave(filename="Rose_Length_Summary.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
(Rose_M_Summary1<- Rose_M %>% tbl_summary(by = Month, include = c(Total.Length, Total.Mass, Age), missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
(Rose_M_Summary1<- Rose_M %>% tbl_summary(by = Month, include = c(Total.Length, Total.Mass), missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}", "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**"))
library(ggplot2)
ggplot(AllRG, aes(x=Total.Length, fill=Sex)) + geom_histogram(binwidth = 10, color="black") + facet_grid(cols = vars(AllRG$Site)) + labs(title = "Histogram of round goby lengths and sexes", subtitle = "Thousand Islands, 2018-2019", x = "Total Length (mm)",  y = "Count") + scale_fill_grey() + theme_classic ()
(Cobb_length_plot<-ggplot(Cobb, aes(x=Total.Length, fill=Sex)) + geom_histogram(binwidth = 10, color="black") + labs(x = "Total Length (mm)",  y = "Count", title="Cobb") + scale_fill_grey() + theme_classic ()+ scale_fill_grey() + theme_classic () + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom") + ylim(0,250)+ xlim(0,250))
ggsave("Cobb_lengthCounts.jpeg", device="jpeg", plot=Cobb_length_plot, path="G:/POP_STRUCTURE_PUB/Figures", dpi="retina", width = 7.48031, height = 5)
(Rose_length_plot<-ggplot(Rose, aes(x=Total.Length, fill=Sex)) + geom_histogram(binwidth = 10, color="black") + labs(x = "Total Length (mm)",  y = "Count", title="Rose") + scale_fill_grey() + theme_classic ()+ scale_fill_grey() + theme_classic () + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom")+ ylim(0,250)+ xlim(0,250))
ggsave("Rose_lengthCounts.jpeg", device="jpeg", plot=Rose_length_plot, path="G:/POP_STRUCTURE_PUB/Figures", dpi="retina", width = 7.48031, height = 5)
Length_Histogram<- ggarrange(Cobb_length_plot + rremove ("ylab") , Rose_length_plot + rremove ("ylab"),
ncol = 1, nrow = 2, common.legend = TRUE, legend="bottom")
(Length_Histogram<-annotate_figure(Length_Histogram,left=text_grob("Count", rot = 90, size = 15)))
ggsave("Length_Histogram.jpeg", device="jpeg", plot=Length_Histogram, path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures", dpi="retina", width = 7.48031, height = 9)
Sex_ratio %>%
kbl(caption = "Round goby sex ratio") %>%
kable_classic(full_width = F, html_font = "Cambria")
(Sex_ratio_table<- gt(Sex_ratio) %>% cols_label(
Month="Month",
Male ="Male",
Female="Female",
Ratio ="M:F Ratio" ) %>% tab_options(column_labels.font.weight = "bold", row_group.font.weight = "bold") )
gtsave(filename="Sex_ratio_table.png", path="G:/POP_STRUCTURE_PUB/Figures")
Sex_ratio %>%
kbl(caption = "Round goby sex ratio") %>%
kable_classic(full_width = F, html_font = "Cambria")
(Sex_ratio_table<- gt(Sex_ratio) %>% cols_label(
Month="Month",
Male ="Male",
Female="Female",
Ratio ="M:F Ratio" ) %>% tab_options(column_labels.font.weight = "bold", row_group.font.weight = "bold") )
gtsave(filename="Sex_ratio_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
library(ratios)
options(digits = 3)
MF<- AllRG %>% filter(Sex != "I")
Sex_ratio<- xtabs(~  Month + Sex, data=MF)
Sex_ratio<- as.data.frame.matrix(Sex_ratio)
Sex_ratio$ratio<- case_when(
is.na(Sex_ratio$M) & is.na(Sex_ratio$F) ~ 1,
is.na(Sex_ratio$M) & Sex_ratio$F >= 0 ~ 1,
Sex_ratio$M >= 0 & is.na(Sex_ratio$F) ~ 0,
TRUE ~ Sex_ratio$M / Sex_ratio$F)
colnames(Sex_ratio) <- c("Female", "Male", "Ratio")
Month<- rownames(Sex_ratio)
rownames(Sex_ratio)<- NULL
Sex_ratio<- cbind(Month, Sex_ratio)
library(ratios)
options(digits = 3)
MF<- AllRG %>% filter(Sex != "I")
Sex_ratio<- xtabs(~  Month + Sex, data=MF)
Sex_ratio<- as.data.frame.matrix(Sex_ratio)
Sex_ratio$ratio<- case_when(
is.na(Sex_ratio$M) & is.na(Sex_ratio$F) ~ 1,
is.na(Sex_ratio$M) & Sex_ratio$F >= 0 ~ 1,
Sex_ratio$M >= 0 & is.na(Sex_ratio$F) ~ 0,
TRUE ~ Sex_ratio$M / Sex_ratio$F)
colnames(Sex_ratio) <- c("Female", "Male", "Ratio")
Month<- rownames(Sex_ratio)
rownames(Sex_ratio)<- NULL
Sex_ratio<- cbind(Month, Sex_ratio)
Sex_ratio %>%
kbl(caption = "Round goby sex ratio") %>%
kable_classic(full_width = F, html_font = "Cambria")
(Sex_ratio_table<- gt(Sex_ratio) %>% cols_label(
Month="Month",
Male ="Male",
Female="Female",
Ratio ="M:F Ratio" ) %>% tab_options(column_labels.font.weight = "bold", row_group.font.weight = "bold") )
gtsave(filename="Sex_ratio_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
(Sex_ratio_table<- gt(Sex_ratio) %>% cols_label(
Month="Month",
Male ="Male",
Female="Female",
Ratio ="M:F Ratio" ) %>% tab_options(column_labels.font.weight = "bold", row_group.font.weight = "bold") )
(Sex_ratio_table<- gt(Sex_ratio) %>% cols_label(
Month="Month",
Male ="Male",
Female="Female",
Ratio ="M:F Ratio" ) %>% tab_options(column_labels.font.weight = "bold", row_group.font.weight = "bold") %>% gtsave(filename="Sex_ratio_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures"))
chisq.test(Sex_ratio)
(Sex_ratio_table<- gt(Sex_ratio) %>% cols_label(
Month="Month",
Male ="Male",
Female="Female",
Ratio ="M:F Ratio" ) %>% tab_options(column_labels.font.weight = "bold", row_group.font.weight = "bold") %>% gtsave(filename="Sex_ratio_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures"))
chisq.test(Sex_ratio)
View(Sex_ratio)
chisq.test(Sex_ratio$Ratio)
View(Sex_ratio)
Cobb_M_Summary1<- Cobb_M %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_F_Summary1<- Cobb_F %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})" )) %>% modify_header(all_stat_cols() ~ "**{level}**")
Cobb_I_Summary1<- Cobb_I %>% tbl_summary(by = Month, include = Total.Length, missing = "no", type = all_continuous() ~ "continuous2", statistic =  all_continuous() ~ c("{N_nonmiss}",  "{min}, {max}", "{mean}({sd})"))%>% modify_header(all_stat_cols() ~ "**{level}**")
(Cobb_Summary<- tbl_stack(tbls=list(Cobb_M_Summary1, Cobb_F_Summary1, Cobb_I_Summary1), group_header =c("Male", "Female", "Immature")) %>% as_gt() %>%
gt::tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
))
Cobb_Summary %>% gtsave(filename="Cobb_Length_Summary.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
###Check ANCOVA assumptions
summary(aov(AgeRad~Site, data=RG_long_F)) ## covariate and treatment are independent
library(FSA)
library(nlstools)
library(magrittr)
library(dplyr)
library(plotrix)
library(nnet)
library(nls2)
library(ggpubr)
library(rlang)
library(ggpubr)
library(sjPlot)
library(gt)
library(gridExtra)
library(grid)
library(patchwork)
library(kableExtra)
library(gtsummary)
library(webshot)
#Load data
getwd()
setwd("G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE")
RG <- read_excel("Pop_Strucutre_Dissected.xlsx")
##5mm length categories; remove unaged
RG %<>% mutate(lcat5=lencat(Length, w=5)) %<>% filter(!is.na(RG$Age))
RG %<>% mutate(lcat5=lencat(Length, w=5)) %<>% filter(!is.na(RG$Age))
##5mm length categories; remove unaged
RG %<>% mutate(lcat5=lencat(Total.Length, w=5)) %<>% filter(!is.na(RG$Age))
headtail(RG)
Male<- filter(RG, Sex== "M")
Female<- filter(RG, Sex=="F")
(alk.freq<- xtabs(~lcat5+Age, data=RG))
alk.prop<- (prop.table(alk.freq))
round(alk.prop, 3)
len<- xtabs(~lcat5, data=RG)
alkMeanVar(alk.freq, Length~lcat5+Age, data=RG, len.n = len)
alkMeanVar(alk.freq, Total.Length~lcat5+Age, data=RG, len.n = len)
(alk.freq<- xtabs(~lcat5+Age, data=RG))
alk.prop<- (prop.table(alk.freq))
round(alk.prop, 3)
len<- xtabs(~lcat5, data=RG)
alkMeanVar(alk.freq, Total.Length~lcat5+Age, data=RG, len.n = len)
mod1 <- multinom(Age~lcat5,data=RG,maxit=500)
mod2 <- multinom(Age~lcat5*Sex,data=RG,maxit=500)
anova(mod1,mod2)
mod1 <- multinom(Age~lcat5,data=RG,maxit=500)
mod2 <- multinom(Age~lcat5*Site,data=RG,maxit=500)
anova(mod1,mod2)
(alk.freq.M<- xtabs(~lcat5+Age, data=Male))
alk.prop.M<- (prop.table(alk.freq.M))
round(alk.prop.M, 3)
len.M<- xtabs(~lcat5, data=Male)
alkMeanVar(alk.freq.M, Length~lcat5+Age, data=Male, len.n = len.M)
(alk.freq.M<- xtabs(~lcat5+Age, data=Male))
alk.prop.M<- (prop.table(alk.freq.M))
round(alk.prop.M, 3)
len.M<- xtabs(~lcat5, data=Male)
alkMeanVar(alk.freq.M, Total.Length~lcat5+Age, data=Male, len.n = len.M)
Mmod1 <- multinom(Age~lcat5,data=Male,maxit=500)
Mmod2 <- multinom(Age~lcat5*Site,data=Male,maxit=500)
anova(Mmod1,Mmod2)
(alk.freq.F<- xtabs(~lcat5+Age, data=Female))
alk.prop.F<- (prop.table(alk.freq.F))
round(alk.prop.F, 3)
len.F<- xtabs(~lcat5, data=Female)
alkMeanVar(alk.freq.F, Total.Length~lcat5+Age, data=Female, len.n = len.F)
Fmod1 <- multinom(Age~lcat5,data=Female,maxit=500)
Fmod2 <- multinom(Age~lcat5*Site,data=Female,maxit=500)
anova(Fmod1,Fmod2)
(MVB <- vbStarts(Length~Age,data=Male))
(MVB <- vbStarts(Length~Age,data=Male))
mTyp<- list(Linf=max(Male$Length, na.rm=TRUE), K=0.24, t0=-2.23)
(MVB <- vbStarts(Length~Age,data=Male))
(MVB <- vbStarts(Total.Length~Age,data=Male))
mTyp<- list(Linf=max(Male$Length, na.rm=TRUE), K=0.24, t0=-2.23)
(MVB <- vbStarts(Total.Length~Age,data=Male))
mTyp<- list(Linf=max(Male$Length, na.rm=TRUE), K=0.24, t0=-2.23)
mfun<- function(age, Linf, K, t0) Linf*(1-exp(-K*(age-t0)))
fitMVB <-nls(Length~mfun(Age, Linf,K,t0), data=Male, start=MVB)
fitMVB <-nls(Total.Length~mfun(Age, Linf,K,t0), data=Male, start=MVB)
(MVB <- vbStarts(Total.Length~Age,data=Male))
mTyp<- list(Linf=max(Male$Length, na.rm=TRUE), K=0.24, t0=-2.23)
mfun<- function(age, Linf, K, t0) Linf*(1-exp(-K*(age-t0)))
fitMVB <-nls(Total.Length~mfun(Age, Linf,K,t0), data=Male, start=MVB)
coef(fitMVB)
confint(fitMVB)
bootMVB <- nlsBoot(fitMVB)
headtail(bootMVB$coefboot,n=2)
summary(fitMVB,correlation=TRUE)
(x<- seq(0, 6, length.out=7))
(pMVB<- mfun(x, Linf=262.03, K=0.31677, t0=-0.26853))
xlmts<-range(c(x, Male$age))
(ylmts<- range(c(pMVB,Male$Length)))
plot(Length~Age, data=Male, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
plot(Total.Length~Age, data=Male, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
lines(pMVB~x, lwd=2)
plot(Total.Length~Age, data=Male, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
lines(pMVB~x, lwd=2)
Male$Site<- as.factor(Male$Site)
vbLKt <- Total.Length~Linf[Site]*(1-exp(-K[Site]*(Age-t0[Site])))
vbLK <- Total.Length~Linf[Site]*(1-exp(-K[Site]*(Age-t0)))
vbLt <- Total.Length~Linf[Site]*(1-exp(-K*(Age-t0[Site])))
vbKt <- Total.Length~Linf*(1-exp(-K[Site]*(Age-t0[Site])))
vbL <- Total.Length~Linf[Site]*(1-exp(-K*(Age-t0)))
vbK <- Total.Length~Linf*(1-exp(-K[Site]*(Age-t0)))
vbt <- Total.Length~Linf*(1-exp(-K*(Age-t0[Site])))
vbO <- Total.Length~Linf*(1-exp(-K*(Age-t0)))
(MaleLKt<- Map(rep, MVB, c(2,2,2)))
MfitLKt <- nls(vbLKt,data=Male,start=MaleLKt)
summary(MfitLKt)
Mfit0 <- nls(vbO,data=Male,start=MVB)
MVB_lrt<-lrt(Mfit0,com=MfitLKt,com.name="All pars differ",
sim.names="No pars differ")
MVB_lrt$test<- "Likelihood Ratio Test"
MVB_eSS<-extraSS(Mfit0,com=MfitLKt,com.name="All pars diff",
sim.names="No pars diff")
MVB_eSS$test<- "extra Sum of Squares"
MVB_Stat<- rbind(MVB_lrt, MVB_eSS)
## Conlcusion- there is a significant difference between parameters
msvLK<-Map(rep, MVB, c(2,2,1))
msvLt<- Map(rep, MVB, c(2,1,2))
msvKt<- Map(rep, MVB, c(1,2,2))
MfitLK<-nls(vbLK,data=Male,start=msvLK)
MfitLt<-nls(vbLt,data=Male,start=msvLt)
MfitKt<-nls(vbKt,data=Male,start=msvKt)
MLRT<-lrt(MfitLK, MfitLt, MfitKt,com=MfitLKt,com.name="All pars diff",
sim.names=c("Linf,K diff","Linf,t0 diff","K,t0 diff"))
MESS<- extraSS(MfitLK, MfitLt, MfitKt,com=MfitLKt,com.name="All pars diff",
sim.names=c("Linf,K diff","Linf,t0 diff","K,t0 diff"))
MVB_Test<- rbind(MLRT, MESS)
##Conclusion- {L,t0}, {K, t0} fit the data; use {L, T0} for further selection because it has the greatest log-likelihood value
msvLK<-Map(rep, MVB, c(2,2,1))
msvLt<- Map(rep, MVB, c(2,1,2))
msvKt<- Map(rep, MVB, c(1,2,2))
MfitLK<-nls(vbLK,data=Male,start=msvLK)
MfitLt<-nls(vbLt,data=Male,start=msvLt)
MfitKt<-nls(vbKt,data=Male,start=msvKt)
MLRT<-lrt(MfitLK, MfitLt, MfitKt,com=MfitLKt,com.name="All pars diff",
sim.names=c("Linf,K diff","Linf,t0 diff","K,t0 diff"))
MESS<- extraSS(MfitLK, MfitLt, MfitKt,com=MfitLKt,com.name="All pars diff",
sim.names=c("Linf,K diff","Linf,t0 diff","K,t0 diff"))
MVB_Test<- rbind(MLRT, MESS)
##Conclusion- {L,t0}, {K, t0} fit the data; use {L, T0} for further selection because it has the greatest log-likelihood value
MsvL <- Map(rep,MVB,c(2,1,1))
Msvt <- Map(rep,MVB,c(1,1,2))
MsvK<- Map(rep, MVB, c(1, 2, 1))
MfitL <- nls(vbL,data=Male,start=MsvL)
Mfitt <- nls(vbt,data=Male,start=Msvt)
MfitK<- nls(vbK, data=Male, start=MsvK)
lrt(MfitL,Mfitt,com=MfitLt,com.name="Linf,t0 dif",
sim.names=c("Linf dif","t0 dif"))
(MaleVB_model<- tab_model(Mfit0, MfitL, MfitK, Mfitt, MfitLK, MfitLt, MfitKt, MfitLKt,
collapse.ci = TRUE, show.fstat = TRUE , show.aic = TRUE, show.loglik = TRUE,
p.style = "numeric_stars",  CSS = list(css.table = '+font-family: Arial;', file="VB_Male.doc"), auto.label = TRUE))
## {L} and {t0} fit the model
cbind(AIC(MfitLKt,MfitLK,MfitLt,MfitKt,MfitL,MfitK,Mfitt,Mfit0),
BIC(MfitLKt,MfitLK,MfitLt,MfitKt,MfitL,MfitK,Mfitt,Mfit0))
## the t0 model has the lowest AIC and BIC, would be the best model
##Rose
vbTyp <- vbFuns("typical")
rgMr<- filter(Male, Site=="Rose")
rgMr$Length<- as.numeric(rgMr$Length)
##Rose
vbTyp <- vbFuns("typical")
rgMr<- filter(Male, Site=="Rose")
rgMr$Total.Length<- as.numeric(rgMr$Total.Length)
fitMr<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=rgMr, start=MVB)
bMr <- nlsBoot(fitMr)
cbind(coef(fitMr),confint(bMr))
MR_VBSum<- summary(fitMr)
##Cobb
rgMc<- filter(Male, Site=="Cobb")
rgMc$Length<- as.numeric(rgMc$Total.Length)
fitMc<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=rgMc, start=MVB)
bMc <- nlsBoot(fitMc)
cbind(coef(fitMr),confint(bMc))
MC_VBSum<- summary(fitMc)
##Rose predictions
xr<- seq(min(rgMr$Age), max(rgMr$Age), length.out=199)
pr<- vbTyp(xr, Linf=coef(fitMr))
##Cobb predictions
xc<- seq(min(rgMc$Age), max(rgMc$Age), length.out=199)
pc<- vbTyp(xc, Linf=coef(fitMc))
xlmts<- range(c(xr, xc))
ylmts<- range(c(rgMr$Length, rgMc$Length))
roseMVB<-as.data.frame(cbind(xr,pr))
cobbMVB<- as.data.frame(cbind(xc, pc))
plot(Length~Age, data=Male, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, col="white")
(MaleVBPlot1<- ggplot(data=Male, aes(color=Site))+geom_point(aes(x=Age, y=Length, shape=Site))+ scale_color_manual(values = c("Rose"= "black","Cobb"="grey"))  + theme_classic ()  + labs(x = "Age",  y = "Total Length (mm)") + ylim(50,230) + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom") + geom_line(data=roseMVB, aes(x=xr, y=pr), colour=I("black")) + ggtitle("Male") + geom_line(data=cobbMVB,aes(x=xc, y=pc), colour=I("gray")))
(MaleVBPlot1<- ggplot(data=Male, aes(color=Site))+geom_point(aes(x=Age, y=Length, shape=Site))+ scale_color_manual(values = c("Rose"= "black","Cobb"="grey"))  + theme_classic ()  + labs(x = "Age",  y = "Total Length (mm)") + ylim(50,230) + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom") + geom_line(data=roseMVB, aes(x=xr, y=pr), colour=I("black")) + ggtitle("Male") + geom_line(data=cobbMVB,aes(x=xc, y=pc), colour=I("gray")))
(MaleVBPlot1<- ggplot(data=Male, aes(color=Site))+geom_point(aes(x=Age, y=Total.Length, shape=Site))+ scale_color_manual(values = c("Rose"= "black","Cobb"="grey"))  + theme_classic ()  + labs(x = "Age",  y = "Total Length (mm)") + ylim(50,230) + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom") + geom_line(data=roseMVB, aes(x=xr, y=pr), colour=I("black")) + ggtitle("Male") + geom_line(data=cobbMVB,aes(x=xc, y=pc), colour=I("gray")))
MVB<-rbind(fitMc,fitMr)
MrVB_Table<- tbl_regression(fitMr)%>%
add_significance_stars(hide_p = FALSE, pattern = "{p.value}") %>%
add_glance_table(
include = c(nobs, logLik, AIC, BIC))
McVB_Table<- tbl_regression(fitMc) %>%
add_significance_stars(hide_p = FALSE,  pattern = "{p.value}") %>%
add_glance_table(
include = c(nobs, logLik, AIC, BIC))
(alk.freq.F<- xtabs(~lcat5+Age, data=Female))
alk.prop.F<- (prop.table(alk.freq.F))
round(alk.prop.F, 3)
alkPlot(alk.prop.F,type="area",pal="gray",showLegend=TRUE,leg.cex=0.7,xlab="Total Length (mm)")
alkPlot(alk.prop.F,type="bubble",xlab="Total Length (mm)")
len.F<- xtabs(~lcat5, data=Female)
alkMeanVar(alk.freq.F, Length~lcat5+Age, data=Female, len.n = len.F)
(alk.freq.F<- xtabs(~lcat5+Age, data=Female))
alk.prop.F<- (prop.table(alk.freq.F))
round(alk.prop.F, 3)
alkPlot(alk.prop.F,type="area",pal="gray",showLegend=TRUE,leg.cex=0.7,xlab="Total Length (mm)")
alkPlot(alk.prop.F,type="bubble",xlab="Total Length (mm)")
len.F<- xtabs(~lcat5, data=Female)
alkMeanVar(alk.freq.F, Total.Length~lcat5+Age, data=Female, len.n = len.F)
Fmod1 <- multinom(Age~lcat5,data=Female,maxit=500)
Fmod2 <- multinom(Age~lcat5*Site,data=Female,maxit=500)
anova(Fmod1,Fmod2)
(FVB <- vbStarts(Total.Length~Age,data=Female))
FTyp<- vbFuns()
(fitFVB<- nls2(Total.Length~FTyp(Age, Linf, K, t0), data=Female, start=FVB, control = list(maxiter = 10000, minFactor = 1/2048)))
x<- seq(0,6, length.out=199)
pFVB<- FTyp(x,Linf=coef(fitFVB))
xlmts<-range(c(x, Female$age))
ylmts<- range(c(pFVB, Female$Length))
plot(Length~Age, data=Female, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
plot(Total.Length~Age, data=Female, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
lines(pFVB~x, lwd=2)
(FVB <- vbStarts(Length~Age,data=Female))
(FVB <- vbStarts(Total.Length~Age,data=Female))
(FVB <- vbStarts(Total.Length~Age,data=Female))
fTyp<- list(Linf=105.2999, K=0.8056174, t0=-1.255391)
ffun<- function(age, Linf, K, t0) Linf*(1-exp(-K*(age-t0)))
fitFVB <-nls(Length~ffun(Age, Linf,K,t0), data=Female, start=FVB)
(FVB <- vbStarts(Total.Length~Age,data=Female))
fTyp<- list(Linf=105.2999, K=0.8056174, t0=-1.255391)
ffun<- function(age, Linf, K, t0) Linf*(1-exp(-K*(age-t0)))
fitFVB <-nls(Total.Length~ffun(Age, Linf,K,t0), data=Female, start=FVB)
coef(fitFVB)
bootFVB <- nlsBoot(fitFVB)
headtail(bootFVB$coefboot,n=2)
summary(fitFVB,correlation=TRUE)
(x<- seq(0, 6, length.out=199))
(pFVB<- ffun(x, Linf=127.1873, K=0.2763, t0=-2.7931))
xlmts<-range(c(x, Female$Age))
(ylmts<- range(c(pFVB,Female$Length)))
plot(Length~Age, data=Female, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
plot(Total.Length~Age, data=Female, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
lines(pFVB~x, lwd=2)
(FVB <- vbStarts(Total.Length~Age,data=Female))
fTyp<- list(Linf=105.2999, K=0.8056174, t0=-1.255391)
ffun<- function(age, Linf, K, t0) Linf*(1-exp(-K*(age-t0)))
fitFVB <-nls(Total.Length~ffun(Age, Linf,K,t0), data=Female, start=FVB)
coef(fitFVB)
bootFVB <- nlsBoot(fitFVB)
headtail(bootFVB$coefboot,n=2)
summary(fitFVB,correlation=TRUE)
(x<- seq(0, 6, length.out=199))
(pFVB<- ffun(x, Linf=127.1873, K=0.2763, t0=-2.7931))
xlmts<-range(c(x, Female$Age))
(ylmts<- range(c(pFVB,Female$Length)))
plot(Total.Length~Age, data=Female, xlab="Age", ylab="Total Length (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
lines(pFVB~x, lwd=2)
##Need to log-transform
Female$LogLength<-log(Female$Total.Length)
(logFVB <- vbStarts(LogLength~Age,data=Female))
logfTyp<- list(Linf=4.638302, K=0.7862856, t0=-3.014121)
fitlogFVB <-nls(LogLength~ffun(Age, Linf,K,t0), data=Female, start=logFVB)
coef(fitlogFVB)
bootlogFVB <- nlsBoot(fitlogFVB)
headtail(bootlogFVB$coefboot,n=2)
summary(fitlogFVB,correlation=TRUE)
(x<- seq(0, 6, length.out=199))
(plogFVB<- ffun(x, Linf=4.7606, K=0.4187, t0=-5.1522))
xlmts<-range(c(x, Female$Age))
(ylmts<- range(c(plogFVB,Female$LogLength)))
plot(LogLength~Age, data=Female, xlab="Age", ylab="log(Total Length) (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
lines(plogFVB~x, lwd=2)
plot(LogLength~Age, data=Female, xlab="Age", ylab="log(Total Length) (mm)", xlim=xlmts, ylim=ylmts, pch=19, col=rgb(0,0,0,1/3))
lines(plogFVB~x, lwd=2)
Female$Site<- as.factor(Female$Site)
vbLKt <- Length~Linf[Site]*(1-exp(-K[Site]*(Age-t0[Site])))
vbLK <- Length~Linf[Site]*(1-exp(-K[Site]*(Age-t0)))
vbLt <- Length~Linf[Site]*(1-exp(-K*(Age-t0[Site])))
vbKt <- Length~Linf*(1-exp(-K[Site]*(Age-t0[Site])))
vbL <- Length~Linf[Site]*(1-exp(-K*(Age-t0)))
vbK <- Length~Linf*(1-exp(-K[Site]*(Age-t0)))
vbt <- Length~Linf*(1-exp(-K*(Age-t0[Site])))
vbO <- Length~Linf*(1-exp(-K*(Age-t0)))
(FemaleLKt<- Map(rep, FVB, c(2,2,2)))
FfitLKt <- nls(vbLKt,data=Female,start=FemaleLKt, control=list(maxiter=1000000000,minFactor=1/10000000000))  ####Won't converge.
FfitLKt <- nls(vbLKt,data=Female,start=FemaleLKt, control=list(maxiter=1000000000,minFactor=1/10000000000))  ####Won't converge.
