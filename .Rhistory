) %>%
cols_width(Df~px(20), everything()~px(100)) %>% tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for the full model denoted in brackets. L<sub>R</sub> denotes maximum likelihood ratio for reduced model denoted in the rowname.")))
(M_VB_Selection_table<- M_VB_selction %>% gt(rowname_col = "rownames", groupname_col = "selection")  %>%  cols_label(
logLikO = md("**Ln(L<sub>R</sub>)**"),
logLikA = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")) %>% tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100)) %>% tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for the full model denoted in brackets. L<sub>R</sub> denotes maximum likelihood ratio for reduced model denoted in the rowname.")))
(M_VB_Selection_table<- M_VB_selction %>% gt(rowname_col = "rownames", groupname_col = "selection")  %>%  cols_label(
logLikO = md("**Ln(L<sub>R</sub>)**"),
logLikA = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")) %>% tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
) %>%
tab_style(
style = cell_text( align = "right"),
locations = cells_body())%>%
tab_style(
style = cell_text( align = "right"),
locations = cells_stub()) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100)) %>% tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for the full model denoted in brackets. L<sub>R</sub> denotes maximum likelihood ratio for reduced model denoted in the rowname.")))
M_VB_Selection_table %>% gtsave(filename="MVB_params_test_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
M_VB_Selection_table %>% gtsave(filename="MVB_params_test_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
(M_VB_Selection_table<- M_VB_selction %>% gt(rowname_col = "rownames", groupname_col = "selection")  %>%  cols_label(
logLikO = md("**Ln(L<sub>R</sub>)**"),
logLikA = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")) %>% tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
) %>%
tab_style(
style = cell_text( align = "right"),
locations = cells_body())%>%
tab_style(
style = cell_text( align = "right"),
locations = cells_stub()) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100)) %>% tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for the full model denoted in brackets. L<sub>R</sub> denotes maximum likelihood ratio for reduced model denoted in the rowname.")))
M_VB_Selection_table %>% gtsave(filename="M_VB_Selection_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
(VB_LRT_table_print<- VB_LRT_table %>% gt(rowname_col = "Sex") %>% tab_stubhead(label= md("**Sex**")) %>%  cols_label(
loglik0 = md("**Ln(L<sub>R</sub>)**"),
loglikF = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")
) %>%
tab_style(
style = cell_text( align = "right"),
locations = cells_body())%>%
tab_style(
style = cell_text( align = "right"),
locations = cells_stub()) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100))  %>%  tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for full (LKt) model. L<sub>R</sub> denotes maximum likelihood ratio for reduced (0) model.")))
(VB_LRT_table_print<- VB_LRT_table %>% gt(rowname_col = "Sex") %>% tab_stubhead(label= md("**Sex**")) %>%  cols_label(
loglik0 = md("**Ln(L<sub>R</sub>)**"),
loglikF = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")
) %>%
tab_style(
style = cell_text( align = "right"),
locations = cells_body())%>%
tab_style(
style = cell_text( align = "right"),
locations = cells_stub()) %>%
cols_width(df~px(50), Chisq~px(50), everything()~px(100))  %>%  tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for full (LKt) model. L<sub>R</sub> denotes maximum likelihood ratio for reduced (0) model.")))
(VB_LRT_table_print<- VB_LRT_table %>% gt(rowname_col = "Sex") %>% tab_stubhead(label= md("**Sex**")) %>%  cols_label(
loglik0 = md("**Ln(L<sub>R</sub>)**"),
loglikF = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")
) %>%
tab_style(
style = cell_text( align = "right"),
locations = cells_body()) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100))  %>%  tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for full (LKt) model. L<sub>R</sub> denotes maximum likelihood ratio for reduced (0) model.")))
(VB_LRT_table_print<- VB_LRT_table %>% gt(rowname_col = "Sex") %>% tab_stubhead(label= md("**Sex**")) %>%  cols_label(
loglik0 = md("**Ln(L<sub>R</sub>)**"),
loglikF = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")
) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100))  %>%  tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for full (LKt) model. L<sub>R</sub> denotes maximum likelihood ratio for reduced (0) model.")))
(VB_LRT_table_print<- VB_LRT_table %>% gt(rowname_col = "Sex") %>% tab_stubhead(label= md("**Sex**")) %>%  cols_label(
loglik0 = md("**Ln(L<sub>R</sub>)**"),
loglikF = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")
) %>%
tab_style(
style = cell_text( align = "right"),
locations = cells_body()) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100))  %>%  tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for full (LKt) model. L<sub>R</sub> denotes maximum likelihood ratio for reduced (0) model.")))
(VB_LRT_table_print<- VB_LRT_table %>% gt(rowname_col = "Sex") %>% tab_stubhead(label= md("**Sex**")) %>%  cols_label(
loglik0 = md("**Ln(L<sub>R</sub>)**"),
loglikF = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")
) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100))  %>%  tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for full (LKt) model. L<sub>R</sub> denotes maximum likelihood ratio for reduced (0) model.")))
VB_LRT_table_print %>% gtsave(filename="VB_LRT_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
FfitLKt <- nls(vbLKt,data=Female,start=FLKt)
FfitLKt <- nls(vbLK,data=Female,start=FLKt)
summary(FfitLKt)
loglik0<- logLik(Ffit0)
loglikF<- logLik(FfitLKt)
(Flrt<- lrt(Ffit0, com=FfitLKt,com.name="All pars diff",
sim.names=c("no pars diff")))
##Cobb
rgMc<- filter(Male, Site=="Cobb")
rgMc$Length<- as.numeric(rgMc$Total.Length)
fitMc<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=rgMc, start=MVB)
bMc <- nlsBoot(fitMc)
cbind(coef(fitMr),confint(bMc))
##Rose
vbTyp <- vbFuns("typical")
rgMr<- filter(Male, Site=="Rose")
rgMr$Total.Length<- as.numeric(rgMr$Total.Length)
fitMr<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=rgMr, start=MVB)
bMr <- nlsBoot(fitMr)
MR_param<- cbind(coef(fitMr),confint(bMr))
(MR_VBSum<- summary(fitMr))
residPlot(fitMr)
##Cobb
rgMc<- filter(Male, Site=="Cobb")
rgMc$Length<- as.numeric(rgMc$Total.Length)
fitMc<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=rgMc, start=MVB)
bMc <- nlsBoot(fitMc)
cbind(coef(fitMr),confint(bMc))
(MC_VBSum<- summary(fitMc))
residPlot(fitMc)
(MrVB_Table<- tbl_regression(fitMr)%>%
add_significance_stars(hide_p = FALSE, pattern = "{p.value}") %>%
add_glance_table(
include = c(nobs, logLik, AIC, BIC))  )
(McVB_Table<- tbl_regression(fitMc) %>%
add_significance_stars(hide_p = FALSE,  pattern = "{p.value}") %>%
add_glance_table(
include = c(nobs, logLik, AIC, BIC)))
##Rose predictions
xr<- seq(min(rgMr$Age), max(rgMr$Age), length.out=199)
pr<- vbTyp(xr, Linf=coef(fitMr))
roseMVB<-as.data.frame(cbind(xr,pr))
##Cobb predictions
xc<- seq(min(rgMc$Age), max(rgMc$Age), length.out=199)
pc<- vbTyp(xc, Linf=coef(fitMc))
cobbMVB<- as.data.frame(cbind(xc, pc))
(MaleVBPlot1<- ggplot(data=Male, aes(color=Site))+geom_point(aes(x=Age, y=Total.Length, shape=Site))+ scale_color_manual(values = c("Rose"= "black","Cobb"="grey"))  + theme_classic ()  + labs(x = "Age",  y = "Total Length (mm)") + ylim(50,230) + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom") + geom_line(data=roseMVB, aes(x=xr, y=pr), colour=I("black")) + ggtitle("Male") + geom_line(data=cobbMVB,aes(x=xc, y=pc), colour=I("gray")))
library(FSA)
library(nlstools)
library(magrittr)
library(dplyr)
library(plotrix)
library(nnet)
library(nls2)
library(ggpubr)
library(rlang)
library(ggpubr)
library(sjPlot)
library(gt)
library(gridExtra)
library(grid)
library(patchwork)
library(kableExtra)
library(gtsummary)
library(webshot)
library(readxl)
library(lmtest)
library(FSAmisc)
library(nlstools)
#Load data
getwd()
setwd("G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE")
RG <- read_excel("Pop_Strucutre_Dissected.xlsx")
##5mm length categories; remove unaged
RG %<>% mutate(lcat5=lencat(Total.Length, w=5)) %<>% filter(!is.na(RG$Age))
headtail(RG)
Male<- filter(RG, Sex== "M")
Female<- filter(RG, Sex=="F")
(alk.freq<- xtabs(~lcat5+Age, data=RG))
alk.prop<- (prop.table(alk.freq))
round(alk.prop, 3)
len<- xtabs(~lcat5, data=RG)
alkMeanVar(alk.freq, Total.Length~lcat5+Age, data=RG, len.n = len)
mod1 <- multinom(Age~lcat5,data=RG,maxit=500)
mod2 <- multinom(Age~lcat5*Sex,data=RG,maxit=500)
Sex_ALK_ANOVA<- anova(mod1,mod2)  ##No observed differences between sexes for age-length keys
mod1 <- multinom(Age~lcat5,data=RG,maxit=500)
mod2 <- multinom(Age~lcat5*Site,data=RG,maxit=500)
Site_ALK_ANOVA<- anova(mod1,mod2)  ##Significant differences between sites for age-length keys
ALK_ANOVA<- rbind(Sex_ALK_ANOVA, Site_ALK_ANOVA)
(ALK_ANOVA_Table<- gt(ALK_ANOVA) %>% cols_hide("Test") %>% fmt_number(columns = c("Resid. Dev" , "LR stat.", "Pr(Chi)"),  decimals = 2) %>%
tab_style(
style = cell_text( weight = "bold", align = "left"),
locations = cells_group()) %>%
tab_style(
style = cell_text( weight = "bold", align = "left"),
locations = cells_column_labels()
))
(alk.freq.M<- xtabs(~lcat5+Age, data=Male))
alk.prop.M<- (prop.table(alk.freq.M))
round(alk.prop.M, 3)
len.M<- xtabs(~lcat5, data=Male)
alkMeanVar(alk.freq.M, Total.Length~lcat5+Age, data=Male, len.n = len.M)
Mmod1 <- multinom(Age~lcat5,data=Male,maxit=500)
Mmod2 <- multinom(Age~lcat5*Site,data=Male,maxit=500)
Male_Site_ALK_ANOVA<-anova(Mmod1,Mmod2) ## Significant differences between sites among male round gobies
Male_Site_ALK_ANOVA$Sex<- "Male"
(alk.freq.F<- xtabs(~lcat5+Age, data=Female))
alk.prop.F<- (prop.table(alk.freq.F))
round(alk.prop.F, 3)
len.F<- xtabs(~lcat5, data=Female)
alkMeanVar(alk.freq.F, Total.Length~lcat5+Age, data=Female, len.n = len.F)
Fmod1 <- multinom(Age~lcat5,data=Female,maxit=500)
Fmod2 <- multinom(Age~lcat5*Site,data=Female,maxit=500)
Female_Site_ALK_ANOVA<-anova(Fmod1,Fmod2) ##No observed differences between sites among female round gobies
Female_Site_ALK_ANOVA$Sex<- "Female"
ALK_ANOVA_separated<- rbind(Male_Site_ALK_ANOVA, Female_Site_ALK_ANOVA)
(ALK_ANOVA_separated_Table<- gt(ALK_ANOVA_separated, groupname_col = "Sex") %>% cols_hide("Test") %>% fmt_number(columns = c("Resid. Dev" , "LR stat.", "Pr(Chi)"),  decimals = 2) %>%
tab_style(
style = cell_text( weight = "bold", align = "left"),
locations = cells_group()) %>%
tab_style(
style = cell_text( weight = "bold", align = "left"),
locations = cells_column_labels()
))
vbLKt <- Total.Length~Linf[Site]*(1-exp(-K[Site]*(Age-t0[Site])))
vbLK <- Total.Length~Linf[Site]*(1-exp(-K[Site]*(Age-t0)))
vbLt <- Total.Length~Linf[Site]*(1-exp(-K*(Age-t0[Site])))
vbKt <- Total.Length~Linf*(1-exp(-K[Site]*(Age-t0[Site])))
vbL <- Total.Length~Linf[Site]*(1-exp(-K*(Age-t0)))
vbK <- Total.Length~Linf*(1-exp(-K[Site]*(Age-t0)))
vbt <- Total.Length~Linf*(1-exp(-K*(Age-t0[Site])))
vbO <- Total.Length~Linf*(1-exp(-K*(Age-t0)))
Male$Site<- as.factor(Male$Site)
(MVB <- vbStarts(Total.Length~Age,data=Male))
(MLKt<- Map(rep, MVB, c(2,2,2)))
MfitLKt <- nls(vbLKt,data=Male,start=MLKt)
summary(MfitLKt)
Mfit0 <- nls(vbO,data=Male,start=MVB)
summary(Mfit0)
loglik0<- logLik(Mfit0)
loglikF<- logLik(MfitLKt)
(MLRT<-lrt(Mfit0,com=MfitLKt,com.name="All pars diff",
sim.names=c("no pars diff")))
## Conlcusion- there is a significant differences parameters between sites
(Mtest_table<- cbind(loglik0, loglikF, MLRT))
Mtest_table<- Mtest_table[, c(1,2,7,9,10)] %>% round(3)
Mtest_table$Sex<- "Male"
MsvL <- Map(rep,MVB,c(2,1,1))
MsvK<- Map(rep, MVB, c(1, 2, 1))
Msvt <- Map(rep,MVB,c(1,1,2))
msvLK<-Map(rep, MVB, c(2,2,1))
msvLt<- Map(rep, MVB, c(2,1,2))
msvKt<- Map(rep, MVB, c(1,2,2))
MfitL <- nls(vbL,data=Male,start=MsvL)
MfitK<- nls(vbK, data=Male, start=MsvK)
Mfitt <- nls(vbt,data=Male,start=Msvt)
MfitLK<-nls(vbLK,data=Male,start=msvLK)
MfitLt<-nls(vbLt,data=Male,start=msvLt)
MfitKt<-nls(vbKt,data=Male,start=msvKt)
(MaleVB_model<- tab_model(Mfit0, MfitL, MfitK, Mfitt, MfitLK, MfitLt, MfitKt, MfitLKt,
collapse.ci = TRUE, show.fstat = TRUE , show.aic = TRUE, show.loglik = TRUE,
p.style = "numeric_stars",  CSS = list(css.table = '+font-family: Arial;', file="VB_Male.doc"), auto.label = TRUE))
(MLRT<-lrt(Mfit0,com=MfitLKt,com.name="All pars diff",
sim.names=c("no pars diff")))
(MLRT1<-lrt(MfitLK, MfitLt, MfitKt, com=MfitLKt,com.name="all pars diff",
sim.names=c("Linf,K diff","Linf,t0 diff","K,t0 diff")))  # All nested models statistically similar to LKt, use LK model for next round of selection because it has the best logLikO value
(MLRT2<-lrt(MfitL, MfitK, com=MfitLK,com.name="L, K diff",
sim.names=c("Linf", "K diff")))         # Both reduced models similar (K approaching significance), use L for final LRT against null model
(MLRT3<-lrt(Mfit0, com=MfitL, com.name="L diff",
sim.names=c("no pars diff")))         # Linf significant site effect
(M_VB_selction<- data.frame(rbind(MLRT, MLRT1, MLRT2, MLRT3)))
M_VB_selction<- M_VB_selction[, c(2, 4, 5,7, 8)] %>% round(3)
rownames<- c("[LKt] v 0", "[LKt] v LK", "[LKt] v Lt" , "[LKt] v Kt", "[LK] v L", "[LK] v K", "[L] v 0")
selection<- c("Fully nested [LKt]", "1st round [LKt]", "1st round [LKt]", "1st round [LKt]", "2nd round [LK]", "2nd round [LK]", "3rd round [L]")
M_VB_selction<-cbind(M_VB_selction, rownames, selection)
(M_VB_Selection_table<- M_VB_selction %>% gt(rowname_col = "rownames", groupname_col = "selection")  %>%  cols_label(
logLikO = md("**Ln(L<sub>R</sub>)**"),
logLikA = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")) %>% tab_style(
style = gt::cell_text(weight = "bold"),
locations = gt::cells_row_groups(groups = everything())
) %>%
tab_style(
style = cell_text( align = "right"),
locations = cells_body())%>%
tab_style(
style = cell_text( align = "right"),
locations = cells_stub()) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100)) %>% tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for the full model denoted in brackets. L<sub>R</sub> denotes maximum likelihood ratio for reduced model denoted in the rowname.")))
M_VB_Selection_table %>% gtsave(filename="M_VB_Selection_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
##Rose
vbTyp <- vbFuns("typical")
rgMr<- filter(Male, Site=="Rose")
rgMr$Total.Length<- as.numeric(rgMr$Total.Length)
fitMr<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=rgMr, start=MVB)
bMr <- nlsBoot(fitMr)
MR_param<- cbind(coef(fitMr),confint(bMr))
(MR_VBSum<- summary(fitMr))
residPlot(fitMr)
##Cobb
rgMc<- filter(Male, Site=="Cobb")
rgMc$Length<- as.numeric(rgMc$Total.Length)
fitMc<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=rgMc, start=MVB)
bMc <- nlsBoot(fitMc)
cbind(coef(fitMr),confint(bMc))
(MC_VBSum<- summary(fitMc))
residPlot(fitMc)
(MrVB_Table<- tbl_regression(fitMr)%>%
add_significance_stars(hide_p = FALSE, pattern = "{p.value}") %>%
add_glance_table(
include = c(nobs, logLik, AIC, BIC))  )
(McVB_Table<- tbl_regression(fitMc) %>%
add_significance_stars(hide_p = FALSE,  pattern = "{p.value}") %>%
add_glance_table(
include = c(nobs, logLik, AIC, BIC)))
##Rose predictions
xr<- seq(min(rgMr$Age), max(rgMr$Age), length.out=199)
pr<- vbTyp(xr, Linf=coef(fitMr))
roseMVB<-as.data.frame(cbind(xr,pr))
##Cobb predictions
xc<- seq(min(rgMc$Age), max(rgMc$Age), length.out=199)
pc<- vbTyp(xc, Linf=coef(fitMc))
cobbMVB<- as.data.frame(cbind(xc, pc))
(MaleVBPlot1<- ggplot(data=Male, aes(color=Site))+geom_point(aes(x=Age, y=Total.Length, shape=Site))+ scale_color_manual(values = c("Rose"= "black","Cobb"="grey"))  + theme_classic ()  + labs(x = "Age",  y = "Total Length (mm)") + ylim(50,230) + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom") + geom_line(data=roseMVB, aes(x=xr, y=pr), colour=I("black")) + ggtitle("Male") + geom_line(data=cobbMVB,aes(x=xc, y=pc), colour=I("gray")))
ggsave("M_VBGrowth.jpeg", device="jpeg", plot=MaleVBPlot1, path="G:/POP_STRUCTURE_PUB/Figures", dpi="retina", width = 7.48031, height = 5)
Female$Site<- as.factor(Female$Site)
(FVB <- vbStarts(Total.Length~Age,data=Female))
(FLKt<- Map(rep, FVB, c(2,2,2)))
Ffit0 <- nls(vbO,data=Female,start=FVB)
summary(Ffit0)
FfitLKt <- nls(vbLK,data=Female,start=FLKt)
summary(FfitLKt)
loglik0<- logLik(Ffit0)
loglikF<- logLik(FfitLKt)
(Flrt<- lrt(Ffit0, com=FfitLKt,com.name="All pars diff",
sim.names=c("no pars diff")))
Ftest_table<- cbind(loglik0, loglikF, Flrt)
Ftest_table<- Ftest_table[, c(1,2,7,9,10)] %>% round(3)
Ftest_table$Sex<- "Female"
Ftest_table
fitF<- nls(Total.Length~vbTyp(Age, Linf, K, t0), data=Female, start=FVB)
bF <- nlsBoot(fitF)
cbind(coef(fitF),confint(bF))
(F_VBSum<- summary(fitF))
residPlot(fitF)
(F_VB_Table<- tbl_regression(fitF)%>%
add_significance_stars(hide_p = FALSE, pattern = "{p.value}") %>%
add_glance_table(
include = c(nobs, logLik, AIC, BIC))  )
##Female predictions
xf<- seq(min(Female$Age), max(Female$Age), length.out=199)
pf<- vbTyp(xf, Linf=coef(fitF))
FemaleVB<- as.data.frame(cbind(xf, pf))
(FemaleVBPlot<- ggplot(data=Female)+geom_point(aes(x=Age, y=Total.Length, color=Site, shape=Site))+ theme_classic () + geom_line(data=FemaleVB, aes(x=xf, y=pf), color="black") + labs(x = "Age",  y = "Total Length (mm)") + ylim(50,230) + scale_color_manual(values = c("Rose" = "black", "Cobb" = "grey")) + ggtitle("Female") +  theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom"))
ggsave("F_VBGrowth.jpeg", device="jpeg", plot=FemaleVBPlot, path="G:/POP_STRUCTURE_PUB/Figures", dpi="retina", width = 7.48031, height = 5)
VB_LRT_table<- data.frame(rbind(Mtest_table, Ftest_table))
(VB_LRT_table_print<- VB_LRT_table %>% gt(rowname_col = "Sex") %>% tab_stubhead(label= md("**Sex**")) %>%  cols_label(
loglik0 = md("**Ln(L<sub>R</sub>)**"),
loglikF = md("**Ln(L<sub>F</sub>)**"),
Chisq = md("**X<sup>2</sup>**"),
"Pr..Chisq." = md("**P-value**"),
Df= md("**df**")
) %>%
cols_width(Df~px(50), Chisq~px(50), everything()~px(100))  %>%  tab_footnote(
footnote = md("L<sub>F</sub> denotes maximum likelihood ratio for full (LKt) model. L<sub>R</sub> denotes maximum likelihood ratio for reduced (0) model.")))
VB_LRT_table_print %>% gtsave(filename="VB_LRT_table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
(VBFigure <- ggarrange(MaleVBPlot1 + rremove("ylab"), FemaleVBPlot+ rremove("ylab"),
nrow = 2, common.legend = TRUE, legend="bottom"))
annotate_figure(VBFigure, left=text_grob("Total Length (mm)", rot = 90, size = 15))
ggsave("VBGrowth.jpeg", device="jpeg", plot=VBFigure, , path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures", dpi="retina", width = 7.48031, height = 9)
(VB_Table<- tbl_merge(
tbls = list(MrVB_Table, McVB_Table, F_VB_Table),
tab_spanner = c("**Rose Males**", "**Cobb Males**", "**Females**")
) %>% as_gt())
VB_Table %>% gtsave(filename="VB_Parameter_Table.png", path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures")
knitr::opts_chunk$set(echo = TRUE)
library(gt)
library(readxl)
library(gtExtras)
library(webshot2)
##Load data
getwd()
setwd("G:/POP_STRUCTURE_PUB/Data")
RG<-read_xlsx("Temperature_19.xlsx")
##Load data
getwd()
setwd("G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE")
RG<-read_xlsx("Temperature_19.xlsx")
library(lubridate)
Temperature<-read_xlsx("Temperature_19.xlsx")
Temperature<-read_xlsx("Temperature_19.xlsx")
View(Temperature)
knitr::opts_chunk$set(echo = TRUE)
library(gt)
library(readxl)
library(gtExtras)
library(webshot2)
library(lubridate)
##Load data
getwd()
setwd("G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE")
Temperature<-read_xlsx("Temperature_19.xlsx")
View(Temperature)
##Load data
getwd()
setwd("G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE")
Temperature<-read_xlsx("Temperature_19.xlsx")
View(Temperature)
View(Temperature)
Temperature$DateTime<-mdy_hms(Temperature$DateTime)
View(Temperature)
##Load data
getwd()
setwd("G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE")
Temperature<-read_xlsx("Temperature_19.xlsx")
View(Temperature)
Temperature$DateTime<-ymd_hms(Temperature$DateTime)
View(Temperature)
ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site)) + scale_color_manual(values = c("black", "gray") + theme_classic () +labs(x= "DateTime (YYYY-mm-dd hh:mm:ss)", y="Temperautre") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site))
(ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site)) )
library(ggplot2)
(ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site)) )
(ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site)) + scale_color_manual(values = c("black", "gray") + theme_classic () +labs(x= "DateTime (YYYY-mm-dd hh:mm:ss)", y="Temperautre") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)))
(ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site)) + scale_color_manual(values = c("black", "gray") + theme_classic () +labs(x= "DateTime (YYYY-mm-dd hh:mm:ss)", y="Temperautre"))
ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site)) + scale_color_manual(values = c("black", "gray") + theme_classic () +labs(x= "DateTime (YYYY-mm-dd hh:mm:ss)", y="Temperautre"))
ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "DateTime (YYYY-mm-dd hh:mm:ss)", y="Temperautre"))
ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "DateTime (YYYY-mm-dd hh:mm:ss)", y="Temperautre")
ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature")
ggplot(Temperature, aes(x=DateTime, y=Temperature)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)")
Temperautre %>%
mutate(date = floor_date(date)) %>%
group_by(date) %>%
summarize(mean_temp = mean(Temperature))
library(dplyr)
Temperautre %>%
mutate(date = floor_date(date)) %>%
group_by(date) %>%
summarize(mean_temp = mean(Temperature))
Temperature %>%
mutate(date = floor_date(date)) %>%
group_by(date) %>%
summarize(mean_temp = mean(Temperature))
Temperature %>%
mutate(date = md(DateTime)) %>%
group_by(date) %>%
summarize(mean_temp = mean(Temperature))
Temperature<-read_xlsx("Temperature_19.xlsx")
Temperature$DateTime<-ymd_hms(Temperature$DateTime)
Temperature %>%
mutate(date = md(DateTime)) %>%
group_by(date)%>%
group_by(Site) %>%
summarize(mean_temp = mean(Temperature))
Temperature %>%
mutate(date = md(DateTime))
Temperature %>%
mutate(date = floor_date(DateTime, unit="day"))
library(magrittr)
Temperature %<>%
mutate(date = floor_date(DateTime, unit="day"))
View(Temperature)
Temperature %<>%
mutate(date = floor_date(DateTime, unit="day")) %<>% group_by(Site) %<>% group_by(date)
View(Temperature)
Temp_summary<- Temperature %>% summarise(mean.temp=mean(Temperature))
View(Temp_summary)
Temperature %<>%
mutate(date = floor_date(DateTime, unit="day")) %<>% group_by(Site, date)
Temperature$DateTime<-ymd_hms(Temperature$DateTime)
Temperature %<>%
mutate(date = floor_date(DateTime, unit="day")) %<>% group_by(Site, date)
Temp_summary<- Temperature %>% summarise(mean.temp=mean(Temperature))
View(Temp_summary)
ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)")
ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_smooth(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)")
ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_point(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)")
ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)")
View(Temperature)
ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)") + scale_color_manual(values = c("Rose"= "black","Cobb"="grey"))
ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)") + scale_color_manual(values = c("Rose"= "black","Cobb"="darkgrey"))
ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)") + scale_color_manual(values = c("Rose"= "black","Cobb"="darkgrey")) + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom")
TemperaturePlot<- ggplot(Temp_summary, aes(x=date, y=mean.temp)) + geom_line(aes(color=Site))  + theme_classic () + labs(x= "Date", y="Temperature (oC)") + scale_color_manual(values = c("Rose"= "black","Cobb"="darkgrey")) + theme(plot.margin = margin(t=0.1, l=0.1, r=0.1, b=0.1, unit = "cm"), text = element_text(size = 15), legend.position = "bottom")
ggsave("TemperaturePlot.jpeg", device="jpeg", plot=TemperaturePlot, , path="G:/Dissertation/Chapter 2- pop structure/RG_POP_STRUCTURE/Figures", dpi="retina", width = 7.48031, height = 5)
